<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MEMORISE - AI-Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Map viewer (Leaflet) + OpenStreetMap tiles -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <link rel="stylesheet" href="/static/css/app.css" />
</head>
  <body>
    <div class="app-shell">
    <header class="mode-bar">
      <div class="mode-bar-info">
        <div class="app-title">MEMORISE AI-Engine</div>
        <div class="mode-hint">Pick a mode to explore the collection.</div>
      </div>
      <div class="mode-tabs">
        <button class="mode-tab active" data-mode="results" id="tabResults">Explore</button>
        <button class="mode-tab" data-mode="narrative" id="tabNarrative">Narrative</button>
      </div>
    </header>

    <section id="mode-results" class="mode-view active" data-mode="results">
      <div class="page">
        <div class="results-panel">
          <div class="results-header" style="margin-bottom: 4px;">
            <div class="section-title">Results</div>
            <div class="results-count" id="resultsCount">No results yet</div>
          </div>

          <!-- 2D exploration scatter -->
          <section id="mode-explore" class="mode active">
            <div class="explore-toolbar">
              <span class="explore-info" id="exploreInfo">
                Loading topic map…
              </span>
              <select id="topicFilter" class="explore-select">
                <option value="all">All topics</option>
              </select>
            </div>
            <div class="explore-canvas-wrapper">
              <svg id="exploreScatter" class="explore-scatter"></svg>
            </div>
            <div class="explore-hover-card" id="exploreHoverCard" hidden>
              <div class="hover-title" id="hoverTitle"></div>
              <div class="hover-meta" id="hoverMeta"></div>
            </div>
          </section>

          <!-- You can keep your Results / Narrative tabs below if you like -->
          <!-- ... existing Results + Narrative sections ... -->
        <!-- </div> -->

          <div class="results-list" id="resultsList">
            <div class="empty-state">
              Run a text search or geo search to see items here.
              We’ll show image, title, creator, and public link.
            </div>
          </div>

        </div>

        <div class="card">
          <div class="section-title">Text search</div>
          <div class="input-row">
            <input id="textQuery" type="text" placeholder="e.g. &quot;Bergen-Belsen&quot;" />
            <button class="btn btn-primary" id="btnTextSearch" aria-label="Search">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="18.65" y2="18.65"></line>
              </svg>
            </button>
          </div>

          <div class="section-title" style="margin-top: 10px;">Location search</div>
          <div id="map"></div>

          <div class="radius-row">
            <label for="radiusSlider" style="margin: 0;">Radius (meters)</label>
            <span class="chip" id="radiusLabel">5000 m</span>
          </div>
          <input
            id="radiusSlider"
            type="range"
            min="10"
            max="1000"
            step="10"
            value="50"
          />

          <div class="controls-row">
            <button class="btn btn-primary" id="btnGeoSearch" disabled>Geo search</button>
            <button class="btn" id="btnClear">Clear</button>
            <span class="chip" id="coordChip" aria-hidden="true" style="display: none;">
              No location selected
            </span>
          </div>
        </div>
      </div>
    </section>

    <section id="mode-narrative" class="mode-view" data-mode="narrative">
      <div class="page narrative-page">
        <div class="results-panel narrative-panel">
          <div class="results-header" style="margin-bottom: 4px;">
            <div class="section-title">Narrative</div>
            <button class="btn btn-primary" id="btnGenerateNarrative" disabled>
              Generate narrative from results
            </button>
          </div>
          <div class="results-list" id="narrativeContainer">
            <div class="empty-state">
              Run a search in Explore mode, then click “Generate narrative from results”.
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="item-detail-overlay" id="itemDetailOverlay" aria-hidden="true">
    <div class="item-detail-card" role="dialog" aria-modal="true">
      <button class="detail-close" id="detailCloseBtn" aria-label="Close detail view">&times;</button>
      <img id="detailImage" class="detail-image" alt="" />
      <h2 id="detailTitle" class="detail-title"></h2>
      <p id="detailCreator" class="detail-creator"></p>
      <p id="detailText" class="detail-text"></p>
      <dl id="detailMeta" class="detail-meta"></dl>
      <a id="detailLink" class="detail-link" href="#" target="_blank" rel="noopener noreferrer">Open source ↗</a>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet-geosearch@latest/dist/bundle.min.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
